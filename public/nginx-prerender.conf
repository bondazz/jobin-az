# NGINX configuration for prerendering
# Add this to your nginx server block

location / {
    # Check if request is from a bot
    set $prerender 0;
    if ($http_user_agent ~* "googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator|whatsapp") {
        set $prerender 1;
    }
    
    # Don't prerender if requesting static files
    if ($uri ~* "\.(js|css|xml|less|png|jpg|jpeg|gif|pdf|doc|txt|ico|rss|zip|mp3|rar|exe|wmv|doc|avi|ppt|mpg|mpeg|tif|wav|mov|psd|ai|xls|mp4|m4a|swf|dat|dmg|iso|flv|m4v|torrent|ttf|woff|svg|eot)") {
        set $prerender 0;
    }
    
    # Proxy to prerender service if bot detected
    if ($prerender = 1) {
        rewrite .* /prerender$uri? break;
        proxy_pass https://igrtzfvphltnoiwedbtz.supabase.co/functions/v1/prerender-proxy?url=https://jooble.az$request_uri;
        proxy_set_header User-Agent $http_user_agent;
    }
    
    # Serve React app for regular users
    try_files $uri $uri/ /index.html;
}
